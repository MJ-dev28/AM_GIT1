<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ïò§Îäò Î≠ê Î®πÏßÄ?</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff5722">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="icon.png">

    <meta property="og:type" content="website">
    <meta property="og:title" content="Ïò§Îäò Î≠ê Î®πÏßÄ? - Lunch Menu">
    <meta property="og:description" content="Ï†êÏã¨ Î©îÎâ¥ Í≥†ÎØº Ìï¥Í≤∞! Î£∞Î†õÏúºÎ°ú Ï†ïÌï¥Î≥¥ÏÑ∏Ïöî.">
    <meta property="og:image" content="og_image.png">
    <meta property="og:url" content="https://mj-dev28.github.io/AM_GIT1/">

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('ÏÑúÎπÑÏä§ ÏõåÏª§ Îì±Î°ù ÏÑ±Í≥µ'))
                    .catch(err => console.log('Îì±Î°ù Ïã§Ìå®:', err));
            });
        }
    </script>

    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding-top: 20px;
            overscroll-behavior: none;
            margin: 0;
        }

        h2 { margin-bottom: 10px; }

        .roulette-container {
            position: relative;
            width: min(90vw, 360px);
            height: min(90vw, 360px);
        }

        svg {
            width: 100%;
            height: 100%;
            display: block;
            touch-action: manipulation;
        }

        .arrow {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 18px solid #ff5722;
            z-index: 10;
            pointer-events: none;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .modal.hidden { display: none; }

        .modal-content {
            background: #fff;
            padding: 20px;
            width: 80%;
            max-width: 300px;
            border-radius: 12px;
            text-align: center;
        }

        .modal-content button {
            margin-top: 15px;
            padding: 10px 20px;
            border: none;
            background: #ff6a00;
            color: #fff;
            border-radius: 8px;
            font-size: 16px;
        }

        #spinBtn {
            margin-top: 16px;
            padding: 14px 26px;
            font-size: 18px;
            border: none;
            border-radius: 12px;
            background: #ff5722;
            color: white;
            cursor: pointer;
            min-width: 200px;
            touch-action: manipulation;
        }

        #result {
            margin-top: 16px;
            font-size: 20px;
            font-weight: bold;
            min-height: 28px;
        }

        .menu-add {
            margin-top: 18px;
            display: flex;
            gap: 8px;
        }

        .menu-add input {
            padding: 12px;
            font-size: 16px;
            width: 60vw;
            border: 1px solid #ccc;
            border-radius: 8px;
        }

        .menu-add button {
            padding: 12px 18px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px;
            border: 1px solid #ccc;
        }
    </style>
</head>

<body>

    <h2>Ïò§Îäò Î≠ê Î®πÏßÄ? üçΩÔ∏è</h2>
    <p style="color: #666; font-size: 14px; margin-top: -10px;">Lunch Menu</p>

    <div class="roulette-container">
        <div class="arrow"></div>
        <svg id="roulette" viewBox="0 0 300 300"></svg>
    </div>

    <button id="spinBtn">Î£∞Î†õ ÎèåÎ¶¨Í∏∞</button>
    <div id="result"></div>

    <div class="menu-add">
        <input id="menuInput" placeholder="Î©îÎâ¥ Ïù¥Î¶Ñ ÏûÖÎ†•">
        <button id="addBtn">Ï∂îÍ∞Ä</button>
    </div>

    <div id="resultModal" class="modal hidden">
        <div class="modal-content">
            <p id="modalText"></p>
            <button onclick="closeModal()">ÌôïÏù∏</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/gsap.min.js"></script>
    <script>
        const DEFAULT_MENU = ["ÌîºÏûê", "ÏπòÌÇ®", "ÌñÑÎ≤ÑÍ±∞", "Ï¥àÎ∞•", "ÎùºÎ©¥", "ÏÉêÎü¨Îìú", "Îñ°Î≥∂Ïù¥", "Ïä§ÌÖåÏù¥ÌÅ¨"];
        const storedMenu = localStorage.getItem("menuList");
        let menu = storedMenu !== null ? JSON.parse(storedMenu) : [...DEFAULT_MENU];

        const colors = ["#FF6F61", "#6B5B95", "#88B04B", "#F7CAC9", "#92A8D1", "#955251", "#B565A7", "#009B77"];
        const svg = document.getElementById("roulette");
        const resultDiv = document.getElementById("result");
        const input = document.getElementById("menuInput");

        let currentRotation = 0;
        let isSpinning = false;

        function lockScroll(lock) { document.body.style.overflow = lock ? "hidden" : ""; }

        function drawRoulette() {
            svg.innerHTML = "";
            const len = menu.length;
            if (len === 0) return;

            const center = 150, radius = 150;

            if (len === 1) {
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", center); circle.setAttribute("cy", center); circle.setAttribute("r", radius);
                circle.setAttribute("fill", colors[0]);
                circle.addEventListener("click", () => removeMenu(0));
                svg.appendChild(circle);

                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", center); text.setAttribute("y", center);
                text.setAttribute("fill", "#fff"); text.setAttribute("font-size", "20");
                text.setAttribute("text-anchor", "middle"); text.setAttribute("dominant-baseline", "middle");
                text.textContent = menu[0];
                svg.appendChild(text);
                return;
            }

            const sliceAngle = 360 / len;
            menu.forEach((item, i) => {
                const start = sliceAngle * i;
                const end = start + sliceAngle;
                const x1 = center + radius * Math.cos(start * Math.PI / 180);
                const y1 = center + radius * Math.sin(start * Math.PI / 180);
                const x2 = center + radius * Math.cos(end * Math.PI / 180);
                const y2 = center + radius * Math.sin(end * Math.PI / 180);

                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", `M ${center} ${center} L ${x1} ${y1} A ${radius} ${radius} 0 0 1 ${x2} ${y2} Z`);
                path.setAttribute("fill", colors[i % colors.length]);
                path.style.cursor = "pointer";
                path.addEventListener("click", () => removeMenu(i));
                svg.appendChild(path);

                const angle = start + sliceAngle / 2;
                const tx = center + radius * 0.65 * Math.cos(angle * Math.PI / 180);
                const ty = center + radius * 0.65 * Math.sin(angle * Math.PI / 180);

                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", tx); text.setAttribute("y", ty);
                text.setAttribute("fill", "#fff"); text.setAttribute("font-size", "12");
                text.setAttribute("text-anchor", "middle"); text.setAttribute("dominant-baseline", "middle");
                text.setAttribute("transform", `rotate(${angle + 90} ${tx} ${ty})`);
                text.textContent = item;
                text.style.pointerEvents = "none";
                svg.appendChild(text);
            });
        }

        function resetRoulette() {
            currentRotation = 0; isSpinning = false;
            resultDiv.textContent = "";
            gsap.set(svg, { rotation: 0 });
        }

        document.getElementById("spinBtn").onclick = () => {
            if (isSpinning || menu.length === 0) return;
            if (menu.length === 1) { showResult(menu[0]); return; }

            isSpinning = true;
            lockScroll(true);
            const sliceAngle = 360 / menu.length;
            currentRotation += 360 * 5 + Math.random() * 360;

            gsap.to(svg, {
                rotation: currentRotation,
                transformOrigin: "50% 50%",
                duration: 4,
                ease: "power4.out",
                onComplete: () => {
                    lockScroll(false);
                    const fixedAngle = (360 - (currentRotation % 360) + 270) % 360;
                    const index = Math.floor(fixedAngle / sliceAngle);
                    showResult(menu[index % menu.length]);
                    isSpinning = false;
                }
            });
        };

        function addMenu() {
            const value = input.value.trim();
            if (!value) return;
            menu.push(value);
            localStorage.setItem("menuList", JSON.stringify(menu));
            input.value = "";
            drawRoulette(); resetRoulette();
        }

        function removeMenu(index) {
            if (confirm(`'${menu[index]}' Î©îÎâ¥Î•º ÏÇ≠Ï†úÌï†ÍπåÏöî?`)) {
                menu.splice(index, 1);
                localStorage.setItem("menuList", JSON.stringify(menu));
                drawRoulette(); resetRoulette();
            }
        }

        function showResult(menuName) {
            document.getElementById("modalText").textContent = `üçΩÔ∏è Ïò§ÎäòÏùò Ï†êÏã¨ÏùÄ\n\nüëâ ${menuName} üëà`;
            document.getElementById("resultModal").classList.remove("hidden");
        }

        function closeModal() { document.getElementById("resultModal").classList.add("hidden"); }

        document.getElementById("addBtn").onclick = addMenu;
        input.addEventListener("keydown", e => { if (e.key === "Enter") addMenu(); });
        drawRoulette();
    </script>
</body>
</html>
